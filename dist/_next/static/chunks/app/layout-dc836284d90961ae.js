(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[177],{4655:(e,o,t)=>{Promise.resolve().then(t.bind(t,17581)),Promise.resolve().then(t.t.bind(t,65356,23)),Promise.resolve().then(t.t.bind(t,30347,23)),Promise.resolve().then(t.bind(t,73388)),Promise.resolve().then(t.bind(t,57863))},73388:(e,o,t)=>{"use strict";t.r(o),t.d(o,{default:()=>c});var n=t(95155),r=t(63592),s=t(96854),i=t(10810),a=t(34133);function c(){return(0,n.jsxs)(r.A,{sx:{height:"100vh",width:"100vw",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",gap:2},children:[(0,n.jsx)(a.P.div,{initial:{opacity:0,scale:.5},animate:{opacity:1,scale:1},transition:{duration:.5},children:(0,n.jsx)(s.A,{size:60,thickness:4,sx:{color:"#8b5cf6"}})}),(0,n.jsx)(a.P.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5,delay:.2},children:(0,n.jsx)(i.A,{variant:"h6",sx:{color:"#6366f1",fontWeight:500},children:"Loading..."})})]})}},57863:(e,o,t)=>{"use strict";t.d(o,{Providers:()=>h});var n=t(95155),r=t(11612),s=t(77054),i=t(20457),a=t(47235),c=t(63297),l=t(63592),d=t(10810),u=t(22282),m=t(11414);let g=(0,r.A)({palette:{mode:"light",primary:{main:"#2196f3",light:"#64b5f6",dark:"#1976d2"},secondary:{main:"#7C4EFF",light:"#9e7bff",dark:"#5c35cc"},text:{primary:"rgba(0, 0, 0, 0.87)",secondary:"rgba(0, 0, 0, 0.6)"},background:{default:"#FFFFFF",paper:"#FFFFFF"}},typography:{fontFamily:'"Segoe UI Emoji", "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif',fontSize:14},components:{MuiButton:{styleOverrides:{root:{textTransform:"none",borderRadius:"8px"}}},MuiTextField:{styleOverrides:{root:{"& .MuiOutlinedInput-root":{borderRadius:"8px"}}}}}});function f(e){let{error:o,resetErrorBoundary:t}=e;return(0,n.jsxs)(l.A,{sx:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",height:"100vh",padding:3,textAlign:"center"},children:[(0,n.jsx)(d.A,{variant:"h5",color:"error",gutterBottom:!0,children:"Something went wrong"}),(0,n.jsx)(d.A,{color:"textSecondary",sx:{mb:2},children:o.message}),(0,n.jsx)(u.A,{variant:"contained",onClick:t,children:"Try again"})]})}function h(e){let{children:o}=e;return(0,n.jsx)(c.tH,{FallbackComponent:f,children:(0,n.jsxs)(s.A,{theme:g,children:[(0,n.jsx)(i.Ay,{}),(0,n.jsxs)(a.FI,{children:[o,(0,n.jsx)(m.l$,{position:"top-right",toastOptions:{duration:3e3,style:{background:"#333",color:"#fff"}}})]})]})})}},47235:(e,o,t)=>{"use strict";t.d(o,{FI:()=>c,FO:()=>l,cJ:()=>d});var n=t(95155),r=t(12115),s=t(71319),i=t(11414);let a="https://chitchat-socket-server.onrender.com",c=e=>{let{children:o}=e,[t,c]=(0,r.useState)(null),[l,d]=(0,r.useState)(""),m=(0,r.useRef)(""),[g,f]=(0,r.useState)([]),[h,p]=(0,r.useState)(null),[v,x]=(0,r.useState)([]),[C,k]=(0,r.useState)(null);(0,r.useEffect)(()=>{m.current=l},[l]);let b=(0,r.useCallback)(()=>{t&&t.disconnect();let e=m.current||localStorage.getItem("username");if(console.log("Connection Attempt Details:",{usernameRefCurrent:m.current,localStorageUsername:localStorage.getItem("username"),finalUsername:e}),!e)return console.error("No username available for connection"),i.oR.error("Username is required"),!1;try{console.log("Attempting to connect with username:",e),console.log("Socket URL:",a);let o=(0,s.io)(a,{auth:{username:e},transports:["websocket","polling"],reconnection:!0,reconnectionAttempts:10,reconnectionDelay:1e3,timeout:15e3,forceNew:!0,withCredentials:!1});return o.on("connect",()=>(console.log("Detailed Connection Success:",{id:o.id,connected:o.connected,username:o.auth.username||e,transportUsed:o.io.engine.transport.name}),d(e),m.current=e,localStorage.setItem("username",e),o.connected||(console.error("Socket reports not connected despite connect event"),i.oR.error("Connection established but not fully connected")),c(o),window.socket=o,!0)),o.on("connect_error",e=>(console.error("Comprehensive Connection Error:",{message:e.message,name:e.name,stack:e.stack}),i.oR.error("Connection failed: ".concat(e.message,". Check server status.")),c(null),window.socket=null,!1)),!0}catch(e){return console.error("Fatal socket connection error:",e),i.oR.error("Failed to establish socket connection"),!1}},[t]),y=(0,r.useCallback)(()=>{t&&(console.log("Disconnecting socket:",{socketId:t.id,currentUsername:l}),t.disconnect(),c(null),window.socket=null)},[t,l]),S=(0,r.useCallback)(e=>{k(e),p(e)},[]),F=(0,r.useCallback)(()=>{t&&t.emit("requestOnlineUsers")},[t]);return(0,r.useEffect)(()=>{if(!t)return;let e=["connect","disconnect","message","message_updated","previousMessages","reaction_error"];e.forEach(e=>{t.on(e,o=>{console.log("SOCKET EVENT: ".concat(e),{eventData:o,timestamp:new Date().toISOString()})})}),t.on("connect_error",e=>{console.error("Socket Connection Error:",e)}),t.on("reaction_error",e=>{console.error("Reaction Error:",e),i.oR.error("Failed to process reaction. Please try again.")});let o=e=>{console.log("Context: Received online users:",e),x(e)},n=e=>{console.log("Context: User left:",e),x(o=>o.filter(o=>o!==e))},r=e=>{console.log("Context: Received online users from explicit request:",e),x(e)},s=e=>{console.log("Context: Received previous messages:",e.length),f(e)},a=e=>{console.log("Context: Received new message:",{username:e.username,to:e.to,private:e.private,content:e.content}),f(o=>o.some(o=>o.id===e.id)?o:e.private?e.username===l&&e.to===C||e.username===C&&e.to===l?[...o,e]:o:[...o,e])},c=e=>{console.error("Context: Message sending error:",e),i.oR.error(e)},d=e=>{var o;console.log("Context: Detailed Message Update",{event:"message_updated",messageId:e.id,content:e.content,reactions:e.reactions,reactionsLength:null===(o=e.reactions)||void 0===o?void 0:o.length}),f(o=>{let t=o.findIndex(o=>o.id===e.id);if(-1===t)return console.warn("Context: Updated message not found",{updatedMessageId:e.id}),o;let n=[...o];return n[t]={...o[t],...e,reactions:e.reactions||[]},n})},u=e=>{console.error("Context: Reaction error:",e),i.oR.error("Failed to add reaction: ".concat(e.error))};return t.on("userJoined",o),t.on("userLeft",n),t.on("onlineUsers",r),t.on("previousMessages",s),t.on("message",a),t.on("message_error",c),t.on("message_updated",d),t.on("reaction_error",u),()=>{e.forEach(e=>{t.off(e)}),t.off("userJoined",o),t.off("userLeft",n),t.off("onlineUsers",r),t.off("previousMessages",s),t.off("message",a),t.off("message_error",c),t.off("message_updated",d),t.off("reaction_error",u)}},[t,l,C]),(0,n.jsx)(u.Provider,{value:{socket:t,username:l,setUsername:e=>{console.log("Setting username in context:",e),d(e),m.current=e},messages:g,setMessages:f,targetUsername:h,setTargetUsername:p,connect:b,disconnect:y,onlineUsers:v,selectedUser:C,selectUser:S,requestOnlineUsers:F},children:o})},l=()=>{let e=(0,r.useContext)(u);if(!e)throw Error("useSocket must be used within a SocketProvider");return e},d=()=>{let e=(0,r.useContext)(u);if(!e)throw Error("useSocketContext must be used within a SocketProvider");return e},u=(0,r.createContext)(void 0)},30347:()=>{}},e=>{var o=o=>e(e.s=o);e.O(0,[444,943,766,712,733,441,517,358],()=>o(4655)),_N_E=e.O()}]);